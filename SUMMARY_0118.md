# 2026年1月18日工作摘要

本日工作聚焦於對伺服器本地 IPv6 網路的深度診斷，以及對整個 PXE 開機環境的全面健康檢查。

## 1. 伺服器本地 IPv6 ULA 位址問題診斷與修復

*   **問題**：伺服器無法從本機存取自己設定的靜態 ULA IPv6 位址 (`fd00:192:168:1::1`)，導致 `curl`, `ping`, `showmount` 等基於該位址的服務測試失敗。
*   **診斷過程**：
    1.  最初懷疑是防火牆問題，但檢查後排除 (`ip6tables` 預設放行, `ufw` 未啟用)。
    2.  發現手動新增的 IPv6 位址在服務重啟後會消失，因此嘗試將其寫入 `netplan` 設定檔以持久化。
    3.  發現即使寫入設定檔，`netplan apply` 後位址依然沒有生效。
    4.  深入追查 `netplan` 的除錯日誌，最終定位到兩個根本原因：
        *   `netplan` 的設定檔 (`99-pxe-static.yaml`) **放置在錯誤的目錄** (`/root/config/`)，`netplan` 服務並未讀取它。
        *   `NetworkManager` (作為 `netplan` 的預設渲染器) 與靜態 IPv6 設定存在衝突，干擾了位址的配置。
*   **解決方案**：
    1.  將 `99-pxe-static.yaml` 設定檔移動到正確的路徑 `/etc/netplan/`。
    2.  在設定檔中，將 `renderer` 從 `NetworkManager` 修改為 `networkd`。
    3.  停止並禁用 `NetworkManager` 服務，啟用並啟動 `systemd-networkd` 服務，使其完全接管網路配置。
    4.  重新應用 `netplan` 設定後，ULA IPv6 位址 `fd00:192:168:1::1` 成功且永久地設定在網卡上。

## 2. PXE 環境全面健康檢查

在修復了伺服器本地 IPv6 問題後，對整個 PXE 環境進行了全面的自我檢查，模擬客戶端的行為以確認所有服務和檔案都可被順利取得。

*   **檢查項目**：`dnsmasq` (DHCP/TFTP), `nginx` (HTTP), `nfs` 服務。
*   **檢查維度**：同時測試了 IPv4 (`192.168.1.1`) 和 IPv6 (`fd00:192:168:1::1`)。
*   **檢查內容**：服務監聽狀態、檔案路徑、HTTP 檔案存取 (`curl`)、NFS 分享可見性 (`showmount`)。
*   **最終結論**：**所有檢查項目均成功通過**。伺服器端的 PXE 環境 (包含 IPv4 和 IPv6) 已 100% 健康、準備就緒且設定正確。這也再次證實了特定 SUT 的 IPv6 PXE 開機失敗問題，根源在於該 SUT 的韌體。
