# 2026年1月15日 - 1月16日工作摘要

這份文件總結了在這兩天內完成的伺服器設定與故障排除任務。

## 1. 網路位址轉換 (NAT) 與 DNS 問題修復

*   **問題**：內部網路 (`192.168.1.0/24`) 的 DHCP 客戶端可以 `ping` 通外部 IP，但無法瀏覽網頁。
*   **診斷**：
    *   確認了 `ip_forwarding` 已啟用，且 `iptables` 的 MASQUERADE 規則設定正確。
    *   發現問題根源在於 `dnsmasq` 的 DHCP 服務沒有向客戶端提供 DNS 伺服器位址。
*   **解決方案**：修改了 `/etc/dnsmasq.d/pxe-interface.conf`，在 DHCP 設定中加入了 `dhcp-option=6,8.8.8.8,1.1.1.1`，為客戶端指定了公開的 DNS 伺服器。

## 2. PXE 開機環境改造 (轉為 NFS 模式)

*   **問題**：SUT 透過 PXE 開機時，在載入 `initrd` 後系統掛起 (hang)。
*   **診斷**：
    *   發現 SUT 正在使用 "HTTP Boot from ISO" 的模式，這會因為記憶體不足或圖形介面衝突 (Desktop ISO) 而失敗。
    *   追查到一個複雜的連鎖引導 (chain-loading) 流程：TFTP `boot.ipxe` -> HTTP `boot.ipxe` (帶有選單)。
*   **解決方案**：
    1.  **改變策略**：將開機模式從不穩定的 "HTTP Boot from ISO" 更換為更穩定可靠的 "NFS Boot"。
    2.  **安裝與設定 NFS**：安裝 `nfs-kernel-server`，建立 NFS 分享目錄 (`/srv/nfs/ubuntu22` 和 `/srv/nfs/ubuntu2205`)，並將對應的 ISO 檔案內容解壓縮至其中。
    3.  **修改 iPXE 腳本**：
        *   修復了位於 `/var/www/html/pxe/boot.ipxe` 的主選單腳本，將 `ubuntu22` 和 `ubuntu2205` 選項的 `kernel` 參數從 `url=` 改為 `netboot=nfs nfsroot=...`。
        *   修復了 TFTP 的初始腳本 (`/var/lib/tftpboot/boot.ipxe`)，確保它能正確引導至主選單。

## 3. IPv6 網路環境建置

*   **目標**：讓內部網路的設備可以取得 IPv6 位址並連上網際網路。
*   **執行步驟**：
    1.  **啟用 DHCPv6/RA**：在 `dnsmasq` 中啟用路由器廣播 (`enable-ra`) 和 DHCPv6，並設定了 ULA 位址範圍 (`fd00:192:168:1::/64`)。
    2.  **啟用 IPv6 轉發**：在核心層級啟用了 IPv6 封包轉發 (`net.ipv6.conf.all.forwarding=1`)。
    3.  **設定 IPv6 NAT**：新增了一條 `ip6tables` 規則，對來自內部 IPv6 網段的流量進行 MASQUERADE。
*   **結果**：成功讓 SUT 和筆電在作業系統層級取得了 IPv6 位址，並能透過 IPv6 連上網際網路。
*   **SUT 韌體問題**：發現 SUT 的 UEFI 韌體在手動執行 "IPv6 PXE" 時有 Bug (`PXE-E21` 錯誤)，該問題在伺服器端無法解決，已建議更新 SUT 的 BIOS/UEFI 韌體。

## 4. `filebrowser` 服務管理

*   **目標**：重設使用者密碼。
*   **執行步驟**：
    1.  **定位服務**：找到 `filebrowser` 服務的設定，確認其根目錄為 `/srv/filebrowser`，資料庫為 `/etc/filebrowser/database.db`。
    2.  **解決資料庫鎖定**：診斷出指令超時是因為資料庫被正在運行的服務鎖定，並採用了「停止服務 -> 執行指令 -> 重啟服務」的標準流程。
    3.  **處理密碼策略**：
        *   發現 `filebrowser` 有內建的、無法透過設定關閉的「弱密碼」檢查。
        *   在使用者提供了符合強度要求的密碼 (`Aa1234567890`) 後，成功更新了密碼。
    4.  **使用者管理**：
        *   將使用者 `bk1` 更名為 `BK`。
        *   將使用者 `BK` 權限提升為管理員，並將其可存取範圍設為根目錄 (`.`)。
